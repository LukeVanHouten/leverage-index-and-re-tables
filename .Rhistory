}
}
get_li(year = 2025, player = 663728, type = "phLI")
get_li <- function(year, player, type) {
if (type == "phLI") {
phli_df <- leverage_index_df %>%
filter(game_year == year) %>%
mutate(topbot = str_sub(half_inning, 1, 3)) %>%
group_by(game_pk, topbot) %>%
filter(any(batter == player)) %>%
select(-topbot) %>%
ungroup() %>%
group_by(game_pk) %>%
filter(any(!(player %in% batter[1:9])),
row_number() == which(batter == player)[1])
View(phli_df)
# return(mean(phli_df$li))
} else {
pitcher_li_df <- leverage_index_df %>%
filter(pitcher == player)
}
}
get_li(year = 2025, player = 663728, type = "phLI")
get_li <- function(year, player, type) {
if (type == "phLI") {
phli_df <- leverage_index_df %>%
filter(game_year == year) %>%
mutate(topbot = str_sub(half_inning, 1, 3)) %>%
group_by(game_pk, topbot) %>%
filter(any(batter == player)) %>%
select(-topbot) %>%
ungroup() %>%
group_by(game_pk) %>%
filter(any(!(player %in% batter[1:9])),
row_number() == which(batter == player)[1])
return(mean(phli_df$li))
} else {
pitcher_li_df <- leverage_index_df %>%
filter(pitcher == player)
}
}
get_li(year = 2025, player = 663728, type = "phLI")
get_li <- function(year, player, type) {
if (type == "phLI") {
phli_df <- leverage_index_df %>%
filter(game_year == year) %>%
mutate(topbot = str_sub(half_inning, 1, 3)) %>%
group_by(game_pk, topbot) %>%
filter(any(batter == player)) %>%
ungroup() %>%
select(-topbot) %>%
group_by(game_pk) %>%
filter(any(!(player %in% batter[1:9])),
row_number() == which(batter == player)[1])
return(mean(phli_df$li))
} else {
pitcher_li_df <- leverage_index_df %>%
filter(pitcher == player)
}
}
get_li(year = 2025, player = 663728, type = "phLI")
get_li <- function(year, player, type) {
if (type == "pLI") {
pli_df <- leverage_index_df %>%
filter(if_any(c("pitcher", "batter") ~ .x == player))
View(pli_df)
} else if (type == "phLI") {
phli_df <- leverage_index_df %>%
filter(game_year == year) %>%
mutate(topbot = str_sub(half_inning, 1, 3)) %>%
group_by(game_pk, topbot) %>%
filter(any(batter == player)) %>%
ungroup() %>%
select(-topbot) %>%
group_by(game_pk) %>%
filter(any(!(player %in% batter[1:9])),
row_number() == which(batter == player)[1])
return(mean(phli_df$li))
} else {
pitcher_li_df <- leverage_index_df %>%
filter(pitcher == player)
}
}
get_li(year = 2025, player = 663728, type = "pLI")
get_li <- function(year, player, type) {
if (type == "pLI") {
pli_df <- leverage_index_df %>%
filter(if_any(everything(), c("pitcher", "batter") ~ .x == player))
View(pli_df)
} else if (type == "phLI") {
phli_df <- leverage_index_df %>%
filter(game_year == year) %>%
mutate(topbot = str_sub(half_inning, 1, 3)) %>%
group_by(game_pk, topbot) %>%
filter(any(batter == player)) %>%
ungroup() %>%
select(-topbot) %>%
group_by(game_pk) %>%
filter(any(!(player %in% batter[1:9])),
row_number() == which(batter == player)[1])
return(mean(phli_df$li))
} else {
pitcher_li_df <- leverage_index_df %>%
filter(pitcher == player)
}
}
get_li(year = 2025, player = 663728, type = "pLI")
get_li <- function(year, player, type) {
if (type == "pLI") {
pli_df <- leverage_index_df %>%
filter(if_any(c(pitcher, batter) ~ .x == player))
View(pli_df)
} else if (type == "phLI") {
phli_df <- leverage_index_df %>%
filter(game_year == year) %>%
mutate(topbot = str_sub(half_inning, 1, 3)) %>%
group_by(game_pk, topbot) %>%
filter(any(batter == player)) %>%
ungroup() %>%
select(-topbot) %>%
group_by(game_pk) %>%
filter(any(!(player %in% batter[1:9])),
row_number() == which(batter == player)[1])
return(mean(phli_df$li))
} else {
pitcher_li_df <- leverage_index_df %>%
filter(pitcher == player)
}
}
get_li(year = 2025, player = 663728, type = "pLI")
get_li <- function(year, player, type) {
if (type == "pLI") {
pli_df <- leverage_index_df %>%
filter(if_any(c(pitcher, batter), ~ .x == player))
View(pli_df)
} else if (type == "phLI") {
phli_df <- leverage_index_df %>%
filter(game_year == year) %>%
mutate(topbot = str_sub(half_inning, 1, 3)) %>%
group_by(game_pk, topbot) %>%
filter(any(batter == player)) %>%
ungroup() %>%
select(-topbot) %>%
group_by(game_pk) %>%
filter(any(!(player %in% batter[1:9])),
row_number() == which(batter == player)[1])
return(mean(phli_df$li))
} else {
pitcher_li_df <- leverage_index_df %>%
filter(pitcher == player)
}
}
get_li(year = 2025, player = 663728, type = "pLI")
filter(leverage_index_df, game_year == 2025, player = 663728) %>% VieW()
filter(leverage_index_df, game_year == 2025, player = 663728) %>% View()
filter(leverage_index_df, game_year == 2025, player == 663728) %>% View()
filter(leverage_index_df, game_year == 2025, batter == 663728) %>% View()
get_li <- function(year, player, type) {
if (type == "pLI") {
pli_df <- leverage_index_df %>%
filter(game_year == year, if_any(c(pitcher, batter),
~ .x == player))
View(pli_df)
} else if (type == "phLI") {
phli_df <- leverage_index_df %>%
filter(game_year == year) %>%
mutate(topbot = str_sub(half_inning, 1, 3)) %>%
group_by(game_pk, topbot) %>%
filter(any(batter == player)) %>%
ungroup() %>%
select(-topbot) %>%
group_by(game_pk) %>%
filter(any(!(player %in% batter[1:9])),
row_number() == which(batter == player)[1])
return(mean(phli_df$li))
} else {
pitcher_li_df <- leverage_index_df %>%
filter(pitcher == player)
}
}
get_li(year = 2025, player = 663728, type = "pLI")
get_li(year = 2025, player = 669302, type = "pLI")
filter(leverage_index_df, game_year == 2025, pitcher == 669302) %>% View()
get_li(year = 2025, player = 669302, type = "pLI")
get_li <- function(year, player, type) {
if (type == "pLI") {
pli_df <- leverage_index_df %>%
filter(game_year == year, if_any(c(pitcher, batter),
~ .x == player))
return(mean(pli_df$li))
} else if (type == "phLI") {
phli_df <- leverage_index_df %>%
filter(game_year == year) %>%
mutate(topbot = str_sub(half_inning, 1, 3)) %>%
group_by(game_pk, topbot) %>%
filter(any(batter == player)) %>%
ungroup() %>%
select(-topbot) %>%
group_by(game_pk) %>%
filter(any(!(player %in% batter[1:9])),
row_number() == which(batter == player)[1])
return(mean(phli_df$li))
} else {
pitcher_li_df <- leverage_index_df %>%
filter(pitcher == player)
}
}
get_li(year = 2025, player = 669302, type = "pLI")
get_li <- function(year, player, type) {
if (type == "phLI") {
phli_df <- leverage_index_df %>%
filter(game_year == year) %>%
mutate(topbot = str_sub(half_inning, 1, 3)) %>%
group_by(game_pk, topbot) %>%
filter(any(batter == player)) %>%
ungroup() %>%
select(-topbot) %>%
group_by(game_pk) %>%
filter(any(!(player %in% batter[1:9])),
row_number() == which(batter == player)[1])
return(mean(phli_df$li))
} else {
pli_df <- leverage_index_df %>%
filter(game_year == year, if_any(c(pitcher, batter),
~ .x == player))
if (type == "gmLI") {
gmli_df <- pli_df %>%
group_by(game_pk) %>%
filter(row_number() == 1)
View(gmli_df)
}
}
}
get_li(year = 2025, player = 669302, type = "gmLI")
get_li <- function(year, player, type) {
if (type == "phLI") {
phli_df <- leverage_index_df %>%
filter(game_year == year) %>%
mutate(topbot = str_sub(half_inning, 1, 3)) %>%
group_by(game_pk, topbot) %>%
filter(any(batter == player)) %>%
ungroup() %>%
select(-topbot) %>%
group_by(game_pk) %>%
filter(any(!(player %in% batter[1:9])),
row_number() == which(batter == player)[1])
return(mean(phli_df$li))
} else {
pli_df <- leverage_index_df %>%
filter(game_year == year, if_any(c(pitcher, batter),
~ .x == player))
if (type == "gmLI") {
gmli_df <- pli_df %>%
group_by(game_pk) %>%
filter(row_number() == 1)
View(gmli_df)
} else{
return(mean(pli_df$li))
}
}
}
get_li(year = 2025, player = 669302, type = "gmLI")
filter(leverage_index_df, game_date == "2025-04-01", fielding_team == "SEA") %>% View()
filter(stats_df, game_date == "2025-04-01", fielding_team == "SEA") %>% View()
filter(stats_df, game_date == "2025-04-01", fielding_team == "SEA")
h
m
View(no_score_df)
get_li(year = 2023, player = 669302, type = "gmLI")
get_li(year = 2023, player = 669302, type = "gmLI")
get_li <- function(year, player, type) {
if (type == "phLI") {
phli_df <- leverage_index_df %>%
filter(game_year == year) %>%
mutate(topbot = str_sub(half_inning, 1, 3)) %>%
group_by(game_pk, topbot) %>%
filter(any(batter == player)) %>%
ungroup() %>%
select(-topbot) %>%
group_by(game_pk) %>%
filter(any(!(player %in% batter[1:9])),
row_number() == which(batter == player)[1])
return(mean(phli_df$li))
} else {
pli_df <- leverage_index_df %>%
filter(game_year == year, if_any(c(pitcher, batter),
~ .x == player))
if (type == "gmLI") {
gmli_df <- pli_df %>%
group_by(game_pk) %>%
filter(row_number() == 1)
return(mean(gmli_df$li))
} else if (type == "inLI") {
inli_df <- pli_df %>%
group_by(game_pk, half_inning) %>%
filter(row_number() == 1)
return(mean(inli_df$li))
} else if (type == "exLI") {
exli_df <- pli_df %>%
group_by(game_pk) %>%
filter(row_number() == n())
return(mean(exli_df$li))
} else {
return(mean(pli_df$li))
}
}
}
get_li(year = 2023, player = 669302, type = "inLI")
get_li(year = 2023, player = 669302, type = "exLI")
get_li <- function(year, player, type) {
if (type == "phLI") {
phli_df <- leverage_index_df %>%
filter(game_year == year) %>%
mutate(topbot = str_sub(half_inning, 1, 3)) %>%
group_by(game_pk, topbot) %>%
filter(any(batter == player)) %>%
ungroup() %>%
select(-topbot) %>%
group_by(game_pk) %>%
filter(any(!(player %in% batter[1:9])),
row_number() == which(batter == player)[1])
return(mean(phli_df$li))
} else {
pli_df <- leverage_index_df %>%
filter(game_year == year, if_any(c(pitcher, batter),
~ .x == player))
if (type == "gmLI") {
gmli_df <- pli_df %>%
group_by(game_pk) %>%
filter(row_number() == 1)
return(mean(gmli_df$li))
} else if (type == "inLI") {
inli_df <- pli_df %>%
group_by(game_pk, half_inning) %>%
filter(row_number() == 1)
return(mean(inli_df$li))
} else if (type == "exLI") {
exli_df <- pli_df %>%
group_by(game_pk) %>%
filter(row_number() == n())
View(exli_df)
# return(mean(exli_df$li))
} else {
return(mean(pli_df$li))
}
}
}
get_li(year = 2023, player = 669302, type = "exLI")
get_li <- function(year, player, type) {
if (type == "phLI") {
phli_df <- leverage_index_df %>%
filter(game_year == year) %>%
mutate(topbot = str_sub(half_inning, 1, 3)) %>%
group_by(game_pk, topbot) %>%
filter(any(batter == player)) %>%
ungroup() %>%
select(-topbot) %>%
group_by(game_pk) %>%
filter(any(!(player %in% batter[1:9])),
row_number() == which(batter == player)[1])
return(mean(phli_df$li))
} else if (type == "exLI") {
print("a")
} else {
pli_df <- leverage_index_df %>%
filter(game_year == year, if_any(c(pitcher, batter),
~ .x == player))
if (type == "gmLI") {
gmli_df <- pli_df %>%
group_by(game_pk) %>%
filter(row_number() == 1)
return(mean(gmli_df$li))
} else if (type == "inLI") {
inli_df <- pli_df %>%
group_by(game_pk, half_inning) %>%
filter(row_number() == 1)
View(inli_df)
# return(mean(inli_df$li))
} else {
return(mean(pli_df$li))
}
}
}
get_li(year = 2023, player = 669302, type = "inLI")
get_li <- function(year, player, type) {
if (type == "phLI") {
phli_df <- leverage_index_df %>%
filter(game_year == year) %>%
mutate(topbot = str_sub(half_inning, 1, 3)) %>%
group_by(game_pk, topbot) %>%
filter(any(batter == player)) %>%
ungroup() %>%
select(-topbot) %>%
group_by(game_pk) %>%
filter(any(!(player %in% batter[1:9])),
row_number() == which(batter == player)[1])
return(mean(phli_df$li))
} else if (type == "exLI") {
exli_df <- leverage_index_df %>%
filter(game_year == year) %>%
mutate(topbot = str_sub(half_inning, 1, 3)) %>%
group_by(game_pk, topbot) %>%
filter(any(pitcher == player)) %>%
ungroup()
View(exli_df)
} else {
pli_df <- leverage_index_df %>%
filter(game_year == year, if_any(c(pitcher, batter),
~ .x == player))
if (type == "gmLI") {
gmli_df <- pli_df %>%
group_by(game_pk) %>%
filter(row_number() == 1)
return(mean(gmli_df$li))
} else if (type == "inLI") {
inli_df <- pli_df %>%
group_by(game_pk, half_inning) %>%
filter(row_number() == 1)
return(mean(inli_df$li))
} else {
return(mean(pli_df$li))
}
}
}
get_li(year = 2023, player = 669302, type = "inLI")
get_li(year = 2023, player = 669302, type = "exLI")
last(c(1, 2, 3))
last(c(1, 2, 3, 1))
get_li <- function(year, player, type) {
if (type == "phLI") {
phli_df <- leverage_index_df %>%
filter(game_year == year) %>%
mutate(topbot = str_sub(half_inning, 1, 3)) %>%
group_by(game_pk, topbot) %>%
filter(any(batter == player)) %>%
ungroup() %>%
select(-topbot) %>%
group_by(game_pk) %>%
filter(any(!(player %in% batter[1:9])),
row_number() == which(batter == player)[1])
return(mean(phli_df$li))
} else if (type == "exLI") {
exli_df <- leverage_index_df %>%
filter(game_year == year) %>%
mutate(topbot = str_sub(half_inning, 1, 3)) %>%
group_by(game_pk, topbot) %>%
filter(any(pitcher == player)) %>%
ungroup() %>%s
select(-topbot)
View(exli_df)
} else {
pli_df <- leverage_index_df %>%
filter(game_year == year, if_any(c(pitcher, batter),
~ .x == player))
if (type == "gmLI") {
gmli_df <- pli_df %>%
group_by(game_pk) %>%
filter(row_number() == 1)
return(mean(gmli_df$li))
} else if (type == "inLI") {
inli_df <- pli_df %>%
group_by(game_pk, half_inning) %>%
filter(row_number() == 1)
return(mean(inli_df$li))
} else {
return(mean(pli_df$li))
}
}
}
get_li(year = 2023, player = 669302, type = "exLI")
get_li <- function(year, player, type) {
if (type == "phLI") {
phli_df <- leverage_index_df %>%
filter(game_year == year) %>%
mutate(topbot = str_sub(half_inning, 1, 3)) %>%
group_by(game_pk, topbot) %>%
filter(any(batter == player)) %>%
ungroup() %>%
select(-topbot) %>%
group_by(game_pk) %>%
filter(any(!(player %in% batter[1:9])),
row_number() == which(batter == player)[1])
return(mean(phli_df$li))
} else if (type == "exLI") {
exli_df <- leverage_index_df %>%
filter(game_year == year) %>%
mutate(topbot = str_sub(half_inning, 1, 3)) %>%
group_by(game_pk, topbot) %>%
filter(any(pitcher == player)) %>%
ungroup() %>%
select(-topbot)
View(exli_df)
} else {
pli_df <- leverage_index_df %>%
filter(game_year == year, if_any(c(pitcher, batter),
~ .x == player))
if (type == "gmLI") {
gmli_df <- pli_df %>%
group_by(game_pk) %>%
filter(row_number() == 1)
return(mean(gmli_df$li))
} else if (type == "inLI") {
inli_df <- pli_df %>%
group_by(game_pk, half_inning) %>%
filter(row_number() == 1)
return(mean(inli_df$li))
} else {
return(mean(pli_df$li))
}
}
}
get_li(year = 2023, player = 669302, type = "exLI")
